"use strict";(globalThis.webpackChunksaturn_cli_docs=globalThis.webpackChunksaturn_cli_docs||[]).push([[711],{2569:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"server-api","title":"Server API Reference - Go Server Toolkit for Job Execution","description":"Complete API reference for Saturn CLI server package. Learn how to create job execution servers and register jobs in your Go applications.","source":"@site/docs/server-api.md","sourceDirName":".","slug":"/server-api","permalink":"/saturncli/docs/server-api","draft":false,"unlisted":false,"editUrl":"https://github.com/Kingson4Wu/saturncli/tree/main/documentation/docs/server-api.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"Server API Reference - Go Server Toolkit for Job Execution","description":"Complete API reference for Saturn CLI server package. Learn how to create job execution servers and register jobs in your Go applications.","keywords":["saturn cli server api","go server library","job execution server","saturn cli server","go background job server","golang server api"]},"sidebar":"tutorialSidebar","previous":{"title":"Client API Reference - Go Library for Saturn CLI Job Execution","permalink":"/saturncli/docs/client-api"},"next":{"title":"CLI Reference - Saturn Command Line Interface Guide","permalink":"/saturncli/docs/cli-reference"}}');var i=n(4848),t=n(8453);const o={sidebar_position:4,title:"Server API Reference - Go Server Toolkit for Job Execution",description:"Complete API reference for Saturn CLI server package. Learn how to create job execution servers and register jobs in your Go applications.",keywords:["saturn cli server api","go server library","job execution server","saturn cli server","go background job server","golang server api"]},l="Server API Reference",a={},c=[{value:"Package Overview",id:"package-overview",level:2},{value:"Creating a Server",id:"creating-a-server",level:2},{value:"NewServer",id:"newserver",level:3},{value:"Options",id:"options",level:2},{value:"WithRegistry",id:"withregistry",level:3},{value:"Server Methods",id:"server-methods",level:2},{value:"Serve",id:"serve",level:3},{value:"Job Registration",id:"job-registration",level:2},{value:"Global Registration Functions",id:"global-registration-functions",level:3},{value:"AddJob",id:"addjob",level:4},{value:"AddStoppableJob",id:"addstoppablejob",level:4},{value:"Registry-Based Registration",id:"registry-based-registration",level:3},{value:"NewRegistry",id:"newregistry",level:4},{value:"Registry.AddJob",id:"registryaddjob",level:4},{value:"Registry.AddStoppableJob",id:"registryaddstoppablejob",level:4},{value:"Job Handler Types",id:"job-handler-types",level:2},{value:"JobHandler",id:"jobhandler",level:3},{value:"StoppableJobHandler",id:"stoppablejobhandler",level:3},{value:"Job Handler Patterns",id:"job-handler-patterns",level:2},{value:"Regular Job Pattern",id:"regular-job-pattern",level:3},{value:"Stoppable Job Pattern",id:"stoppable-job-pattern",level:3},{value:"Complete Usage Example",id:"complete-usage-example",level:2},{value:"Server Lifecycle",id:"server-lifecycle",level:2},{value:"Platform-Specific Behavior",id:"platform-specific-behavior",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"See Also",id:"see-also",level:2}];function d(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"server-api-reference",children:"Server API Reference"})}),"\n",(0,i.jsx)(r.p,{children:"The Saturn CLI server package provides the infrastructure for creating job execution servers. This document details the server API and how to use it in your Go applications for managing background processes."}),"\n",(0,i.jsx)(r.h2,{id:"package-overview",children:"Package Overview"}),"\n",(0,i.jsx)(r.p,{children:"The server package enables you to create custom Saturn job servers that can execute tasks sent by clients. It handles job registration, execution, and lifecycle management."}),"\n",(0,i.jsx)(r.p,{children:"Import the server package:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:'import "github.com/Kingson4Wu/saturncli/server"\n'})}),"\n",(0,i.jsx)(r.h2,{id:"creating-a-server",children:"Creating a Server"}),"\n",(0,i.jsx)(r.h3,{id:"newserver",children:"NewServer"}),"\n",(0,i.jsx)(r.p,{children:"Creates a new server instance with the specified logger and socket path:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:"func NewServer(logger utils.Logger, sockPath string, opts ...Option) *ser\n"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"logger"}),": A logger implementation that satisfies the ",(0,i.jsx)(r.code,{children:"utils.Logger"})," interface"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"sockPath"}),": Path to the Unix domain socket or TCP address for the server"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"opts"}),": Optional configuration options (see ",(0,i.jsx)(r.a,{href:"#options",children:"Options"})," below)"]}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Example:"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:'server := server.NewServer(&utils.DefaultLogger{}, "/tmp/saturn.sock")\nserver.Serve()\n'})}),"\n",(0,i.jsx)(r.h2,{id:"options",children:"Options"}),"\n",(0,i.jsx)(r.h3,{id:"withregistry",children:"WithRegistry"}),"\n",(0,i.jsx)(r.p,{children:"Allows you to specify a custom job registry instead of using the default global registry:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:"func WithRegistry(registry *Registry) Option\n"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Example:"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:'registry := server.NewRegistry()\nserver := server.NewServer(\n    &utils.DefaultLogger{}, \n    "/tmp/saturn.sock", \n    server.WithRegistry(registry),\n)\n'})}),"\n",(0,i.jsx)(r.h2,{id:"server-methods",children:"Server Methods"}),"\n",(0,i.jsx)(r.h3,{id:"serve",children:"Serve"}),"\n",(0,i.jsx)(r.p,{children:"Starts the server and begins listening for client connections. This method blocks the calling goroutine:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:"func (s *ser) Serve()\n"})}),"\n",(0,i.jsx)(r.h2,{id:"job-registration",children:"Job Registration"}),"\n",(0,i.jsx)(r.p,{children:"Saturn supports two types of jobs: regular jobs and stoppable jobs."}),"\n",(0,i.jsx)(r.h3,{id:"global-registration-functions",children:"Global Registration Functions"}),"\n",(0,i.jsx)(r.p,{children:"The server package provides global registration functions that operate on the default global registry:"}),"\n",(0,i.jsx)(r.h4,{id:"addjob",children:"AddJob"}),"\n",(0,i.jsx)(r.p,{children:"Registers a regular (non-stoppable) job globally:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:"func AddJob(name string, handler JobHandler) error\n"})}),"\n",(0,i.jsx)(r.h4,{id:"addstoppablejob",children:"AddStoppableJob"}),"\n",(0,i.jsx)(r.p,{children:"Registers a stoppable job globally:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:"func AddStoppableJob(name string, handler StoppableJobHandler) error\n"})}),"\n",(0,i.jsx)(r.h3,{id:"registry-based-registration",children:"Registry-Based Registration"}),"\n",(0,i.jsx)(r.p,{children:"For more control, create a specific registry:"}),"\n",(0,i.jsx)(r.h4,{id:"newregistry",children:"NewRegistry"}),"\n",(0,i.jsx)(r.p,{children:"Creates a new isolated job registry:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:"func NewRegistry() *Registry\n"})}),"\n",(0,i.jsx)(r.h4,{id:"registryaddjob",children:"Registry.AddJob"}),"\n",(0,i.jsx)(r.p,{children:"Registers a regular job in the specified registry:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:"func (r *Registry) AddJob(name string, handler JobHandler) error\n"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"name"}),": Unique identifier for the job"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"handler"}),": Function that implements the job logic"]}),"\n"]}),"\n",(0,i.jsx)(r.h4,{id:"registryaddstoppablejob",children:"Registry.AddStoppableJob"}),"\n",(0,i.jsx)(r.p,{children:"Registers a stoppable job in the specified registry:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:"func (r *Registry) AddStoppableJob(name string, handler StoppableJobHandler) error\n"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"name"}),": Unique identifier for the job"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"handler"}),": Function that implements the stoppable job logic"]}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"job-handler-types",children:"Job Handler Types"}),"\n",(0,i.jsx)(r.h3,{id:"jobhandler",children:"JobHandler"}),"\n",(0,i.jsx)(r.p,{children:"Function type for regular jobs:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:"type JobHandler func(args map[string]string, signature string) bool\n"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"args"}),": Map of parameters passed from the client"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"signature"}),": Unique identifier for this job run"]}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Return Value:"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"bool"}),": ",(0,i.jsx)(r.code,{children:"true"})," for success, ",(0,i.jsx)(r.code,{children:"false"})," for failure"]}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"stoppablejobhandler",children:"StoppableJobHandler"}),"\n",(0,i.jsx)(r.p,{children:"Function type for stoppable jobs:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:"type StoppableJobHandler func(args map[string]string, signature string, quit chan struct{}) bool\n"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"args"}),": Map of parameters passed from the client"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"signature"}),": Unique identifier for this job run"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"quit"}),": Channel that signals when the job should stop"]}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Return Value:"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"bool"}),": ",(0,i.jsx)(r.code,{children:"true"})," for success, ",(0,i.jsx)(r.code,{children:"false"})," for failure"]}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"job-handler-patterns",children:"Job Handler Patterns"}),"\n",(0,i.jsx)(r.h3,{id:"regular-job-pattern",children:"Regular Job Pattern"}),"\n",(0,i.jsx)(r.p,{children:"Regular jobs execute and return without the ability to be stopped externally:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:'func myJobHandler(args map[string]string, signature string) bool {\n    // Process arguments\n    id := args["id"]\n    version := args["version"]\n    \n    // Perform job work\n    log.Printf("Executing job %s with id=%s, version=%s", signature, id, version)\n    \n    // Do the work...\n    \n    // Return true for success, false for failure\n    return true\n}\n'})}),"\n",(0,i.jsx)(r.h3,{id:"stoppable-job-pattern",children:"Stoppable Job Pattern"}),"\n",(0,i.jsx)(r.p,{children:"Stoppable jobs must regularly check the quit channel to allow graceful shutdown:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:'func myStoppableJobHandler(args map[string]string, signature string, quit chan struct{}) bool {\n    // Process arguments\n    id := args["id"]\n    \n    // Use a ticker to periodically check for quit signal\n    ticker := time.NewTicker(100 * time.Millisecond)\n    defer ticker.Stop()\n    \n    for i := 0; ; i++ {\n        select {\n        case <-quit:\n            log.Printf("Job %s received quit signal at iteration %d", signature, i)\n            return true // Indicate successful clean shutdown\n        case <-ticker.C:\n            // Do work for this iteration\n            log.Printf("Processing iteration %d for job %s", i, signature)\n            \n            // Simulate work\n            time.Sleep(time.Second)\n        }\n    }\n}\n'})}),"\n",(0,i.jsx)(r.h2,{id:"complete-usage-example",children:"Complete Usage Example"}),"\n",(0,i.jsx)(r.p,{children:"Here's a complete example showing how to create a custom Saturn server:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:'package main\n\nimport (\n    "fmt"\n    "log"\n    "time"\n    \n    "github.com/Kingson4Wu/saturncli/server"\n    "github.com/Kingson4Wu/saturncli/utils"\n)\n\nfunc main() {\n    // Create a registry to organize jobs\n    registry := server.NewRegistry()\n    \n    // Register a regular job\n    if err := registry.AddJob("hello", func(args map[string]string, signature string) bool {\n        log.Printf("Hello job running with args: %+v, signature: %s", args, signature)\n        \n        // Simulate some processing time\n        time.Sleep(1 * time.Second)\n        \n        // Optionally return false if job fails\n        if args["fail"] == "true" {\n            log.Printf("Failing job %s intentionally", signature)\n            return false\n        }\n        \n        return true\n    }); err != nil {\n        log.Fatal("Failed to add job:", err)\n    }\n    \n    // Register a stoppable job\n    if err := registry.AddStoppableJob("countdown", func(args map[string]string, signature string, quit chan struct{}) bool {\n        count := 10\n        if args["count"] != "" {\n            fmt.Sscanf(args["count"], "%d", &count)\n        }\n        \n        log.Printf("Countdown job %s starting for %d seconds", signature, count)\n        \n        ticker := time.NewTicker(1 * time.Second)\n        defer ticker.Stop()\n        \n        for i := 0; i < count; i++ {\n            select {\n            case <-quit:\n                log.Printf("Countdown job %s stopped early at step %d", signature, i)\n                return true\n            case <-ticker.C:\n                log.Printf("Countdown job %s: %d remaining", signature, count-i)\n            }\n        }\n        \n        log.Printf("Countdown job %s completed normally", signature)\n        return true\n    }); err != nil {\n        log.Fatal("Failed to add stoppable job:", err)\n    }\n    \n    // Create and start the server with our custom registry\n    server.NewServer(\n        &utils.DefaultLogger{}, \n        "/tmp/my_custom_saturn.sock",\n        server.WithRegistry(registry),\n    ).Serve()\n}\n'})}),"\n",(0,i.jsx)(r.h2,{id:"server-lifecycle",children:"Server Lifecycle"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsx)(r.li,{children:"Create a registry (optional, defaults to global registry)"}),"\n",(0,i.jsx)(r.li,{children:"Register your jobs with handlers"}),"\n",(0,i.jsx)(r.li,{children:"Create a server instance"}),"\n",(0,i.jsxs)(r.li,{children:["Call ",(0,i.jsx)(r.code,{children:"Serve()"})," to start the server"]}),"\n",(0,i.jsx)(r.li,{children:"The server listens for client connections until terminated"}),"\n",(0,i.jsx)(r.li,{children:"Unix socket files are cleaned up automatically on startup"}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"platform-specific-behavior",children:"Platform-Specific Behavior"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Unix-like systems (macOS/Linux)"}),": Uses Unix domain sockets"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Windows"}),": Falls back to TCP connections on localhost"]}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsxs)(r.li,{children:["\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Unique Job Names"}),": Ensure job names are unique within each registry to prevent conflicts."]}),"\n"]}),"\n",(0,i.jsxs)(r.li,{children:["\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Proper Cleanup"}),": Stoppable jobs must properly handle the quit channel to allow graceful shutdown."]}),"\n"]}),"\n",(0,i.jsxs)(r.li,{children:["\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Error Handling"}),": Return ",(0,i.jsx)(r.code,{children:"false"})," from job handlers when errors occur, ",(0,i.jsx)(r.code,{children:"true"})," for success."]}),"\n"]}),"\n",(0,i.jsxs)(r.li,{children:["\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Logging"}),": Use the provided logger for consistent logging across your application."]}),"\n"]}),"\n",(0,i.jsxs)(r.li,{children:["\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Thread Safety"}),": Job handlers may be called concurrently, so ensure thread-safe operations."]}),"\n"]}),"\n",(0,i.jsxs)(r.li,{children:["\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Resource Management"}),": Clean up resources properly in job handlers to prevent leaks."]}),"\n"]}),"\n",(0,i.jsxs)(r.li,{children:["\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Validation"}),": Validate input parameters in job handlers to prevent unexpected behavior."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"see-also",children:"See Also"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.a,{href:"/saturncli/docs/client-api",children:"Client API Reference"})," - For using the Saturn client in your applications"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.a,{href:"/saturncli/docs/embedding",children:"Embedding Guide"})," - For integrating Saturn into your services"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.a,{href:"/saturncli/docs/architecture",children:"Architecture"})," - For understanding the system design"]}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>o,x:()=>l});var s=n(6540);const i={},t=s.createContext(i);function o(e){const r=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(t.Provider,{value:r},e.children)}}}]);